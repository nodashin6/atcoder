:author: nodashin
:date: 2023/04/19

#############################
F - Teleporter and Closed off
#############################

************************************************************
`問題 <https://atcoder.jp/contests/abc291/tasks/abc291_f>`__
************************************************************

.. raw:: html

   <details>
   <summary>問題ページを開きます。</summary>
   <br>
   <iframe src="https://atcoder.jp/contests/abc291/tasks/abc291_f" height="600" width="100%">
   問題リンク
   </iframe>
   <br>
   </details>


****
解説
****

都市 :math:`k` を通らずに，都市 :math:`i` と都市 :math:`j` を通るケースを考えます。
大小関係は :math:`i < k < j` となります。

- 都市 :math:`1` と都市 :math:`i` が距離 :math:`d_{1i}` で移動可能である
- 都市 :math:`j` と都市 :math:`N` が距離 :math:`d_{jN}` で移動可能である
- 都市 :math:`i` と都市 :math:`j` が直接結ばれている
  
この３つの条件を満たすとき，スタートからゴールまで都市 :math:`k` を通らずに移動可能です。
距離は :math:`d_{1i} + d_{jN} + 1` となります。

.. mermaid::

    graph LR
        1(("1"))
        j(("j"))
        i(("i"))
        k(("k"))
        N(("N"))

        1 ===>|d1i| i
        i ===> j
        j ===>|djN| N
        1 -.-> k
        i -.-> k
        k -.-> j
        k -.-> N


具体的な解法は，

- 都市 :math:`1` と都市 :math:`i` が距離 :math:`d_{1i}` で移動可能であることをDPで前計算しておく
- 都市 :math:`j` と都市 :math:`N` が距離 :math:`d_{jN}` で移動可能であることをDPで前計算しておく
- 都市 :math:`k` を跨ぐ，都市 :math:`i` と都市 :math:`j` が直接結ばれているパターンを全探索する

です。:math:`i < k < j` となるような選び方は，都市 :math:`i` から直接到達できる都市が遠くても
:math:`i + M` であることに留意して :math:`M^{2}` 通りです。都市 :math:`k` を全通り探索すると計算量は
:math:`O(NM^{2})` になります。 

入力例1のグラフは次のようなグラフです。

.. mermaid::

    graph LR
        1(("1"))
        2(("2"))
        3(("3"))
        4(("4"))
        5(("5"))

        1 --> 2
        1 --> 3
        2 --> 4
        3 --> 4
        3 --> 5
        4 --> 5

前計算した表は次のようになります。

.. csv-table::
    :header: 都市, 1, 2, 3, 4, 5
    :widths: 10, 5, 5, 5, 5, 5

    始点からの距離, 0, 1, 1, 2, 2
    終点までの距離, 2, 2, 1, 1, 0

雑ですが以上です。